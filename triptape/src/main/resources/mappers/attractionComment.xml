<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ssafy.triptape.attraction.repo.AttractionCommentRepo">
	
	<resultMap type="com.ssafy.triptape.attraction.AttractionDto" id="attraction">
		<id column="attraction_key" property="attractionKey" />
		<result column="name" property="name" />
		<result column="address" property="address"/>
		<result column="latitude" property="latitude"/>
		<result column="longitude" property="longitude"/>
		<result column="description" property="description"/>
		<association property="attractionType" javaType="com.ssafy.triptape.attraction.AttractionTypeDto">
			<result column="type_code" property="typeCode" />
			<result column="type_name" property="typeName" />
		</association>
		<association property="img" javaType="com.ssafy.triptape.file.FileInfoDto">
			<result column="img" property="saveFile"  />
		</association>
	</resultMap>
	
	<resultMap type="com.ssafy.triptape.user.UserDto" id="user">
		<id property="userKey" column="user_key" />
		<result property="isAdmin" column="is_admin" />
		<collection property="profileImg" javaType="com.ssafy.triptape.file.FileInfoDto">
			<result column="saveFile" property="profileImg" />
		</collection>
	</resultMap>

	<resultMap type="com.ssafy.triptape.attraction.AttractionComment" id="comment">
		<id column="comment_key" property="commentKey" />
		<result column="content" property="content"/>
		<result column="createtime" property="createtime"/>
		<result column="description" property="description"/>
		
		<collection property="user" resultMap="user" />
		<collection property="attraction" resultMap="attraction"></collection>
	</resultMap>
	

	<insert id="regist">
		insert into attraction_comment(comment_key, user_key, attraction_key, content, createtime)
		values(#{commentKey}, #{user.userKey}, #{attraction.attractionKey}, #{content}, #{createtime})
	</insert>

	<select id="search" resultMap="comment">
		select  * from attraction_comment a 
					join attraction_info b on a.attraction_key = b.attraction_key
					join user_info c on a.user_key = c.user_key
		limit ${offset}, ${countPerPage}
		order by createtime desc
	</select>

	
	<select id="getTotalListCount" resultType="int">
		select  * from attraction_comment a 
					join attraction_info b on a.attraction_key = b.attraction_key
					join user_info c on a.user_key = c.user_key
	</select>	
	
	<update id="modify">
		update attraction_comment
		set content = #{name}
		where comment_key=#{commentKey}
	</update>
	
	<delete id="delete">
		delete from attraction_comment where comment_key=#{commentKey}
	</delete>
</mapper>